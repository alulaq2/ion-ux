<div class="select_all">
    <input class="checkAllSites" type="checkbox"/> Select All <a href="#" class="expandAllSites">Expand All</a> <a href="#" class="hideAllSites">Hide All</a>
</div>
<div class="list_sites">
    <form action="">
        <% _.each(observatory, function(resource) { %>
            <div id="observatoryName">
                <div class="expandHide arrowRight"></div> <%= resource %> Sites<br/>
                <ul class="showSites">
                <% _.each(resource, function(r) { %>
                    <li><input type="checkbox">
                            <%= r %><br/>
                    </li>
                <% }) %>
                </ul>
            </div>
        <% }) %>
    </form>
</div>

<script>
    $(function(){
        $(".list_sites .resourceLink").click(function(){
            var resource_id = $(this).attr('data-id');
            var url = "/Observatory/face/"+resource_id+"/";
            IONUX.ROUTER.navigate('');
            IONUX.ROUTER.navigate(url, {trigger:true});
            $('#mapButtonHidden').click();
        });

        $('#regionName .expandHide').on('click', function(e) {
            e.preventDefault();
            var $link = $(e.currentTarget);
            $link.parent().children('.showSites').slideToggle('fast', function() {
                console.log($(this) + " and " + $link);
                if ($(this).is(':visible')) {
                    $link.removeClass('arrowDown').addClass('arrowRight');              
                } else {
                    $link.removeClass('arrowRight').addClass('arrowDown');
                }        
            });
        });

        $('.expandAllSites').on('click', function(e) {
            e.preventDefault();
            $('.list_sites').find('.showSites').show();
            $('.list_sites').find('.expandHide').removeClass('arrowRight').addClass('arrowDown');
        });

        $('.hideAllSites').on('click', function(e) {
            e.preventDefault();
            $('.list_sites').find('.showSites').hide();
            $('.list_sites').find('.expandHide').removeClass('arrowDown').addClass('arrowRight');
        });
    });
</script>