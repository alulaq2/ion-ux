<section id="accordion_container">
	<span class="textRight">Save this Search</span>
<article class="left_accordion" id="keyword">
	<span class="accordion_title">
    <div class="expand_hide arrow_down"></div>
    <div class="accordion_label">Keyword</div>
  </span>
	<div class="spatial_details">
		More information
	</div>
</article>
<article class="left_accordion" id="spatial">
  <span class="accordion_title">
	 <div class="expand_hide arrow_down"></div><div class="accordion_label">Spatial</div>
  </span>
	<div class="spatial_details">
    <div class="left_navi_select_container">
  		<select>
  			<option>Lat/Long</option>
  		</select>
      <div class="left_navi_select_arrow"/>
    </div>
		<input class="spatial_duration" type="text" value="Lat" /> <input class="spatial_duration" type="text" value="Long" /> to <input class="spatial_duration" type="text" value="Lat" /> <input class="spatial_duration" type="text" value="Long" />
	</div>
</article>
<article class="left_accordion" id="temporal">
  <span class="accordion_title">
	 <div class="expand_hide arrow_down"></div><div class="accordion_label">Temporal</div>
  </span>
	<div class="spatial_details">
    <div class="left_navi_select_container">
      <select>
        <option>Data Collection</option>
      </select>
      <div class="left_navi_select_arrow"/>
    </div>
		<h5>From</h5>
		<div id='date-dropdown'>
			<select class="date_menu" id="year"></select>
			<select class="date_menu" id='month'></select>
   			<select class="date_menu" id='day'></select>
    	</div>
		<h5>To</h5>
		<div id='date-dropdown'>
			<select class="date_menu" id="year"></select>
			<select class="date_menu" id='month'></select>
   			<select class="date_menu" id='day'></select>
    	</div>
	</div>
</article>
<article class="left_accordion" id="site">
  <span class="accordion_title">
    <div class="expand_hide arrow_down"></div><div class="accordion_label">Site</div>
  </span>
  <div class="spatial_details">
    More information
  </div>
</article>
<article class="left_accordion" id="platform">
  <span class="accordion_title">
    <div class="expand_hide arrow_down"></div><div class="accordion_label">Platform</div>
  </span>
  <div class="spatial_details">
    More information
  </div>
</article>
<article class="left_accordion" id="instrument">
  <span class="accordion_title">
    <div class="expand_hide arrow_down"></div><div class="accordion_label">Instrument</div>
  </span>
  <div class="spatial_details">
    More information
  </div>
</article>
<article class="left_accordion" id="data_type">
  <span class="accordion_title">
    <div class="expand_hide arrow_down"></div><div class="accordion_label">Data Type</div>
  </span>
  <div class="spatial_details">
    More information
  </div>
</article>
<article class="left_accordion" id="boolean_expression">
  <span class="accordion_title">
	 <div class="expand_hide arrow_down"></div><div class="accordion_label">Boolean Expression</div>
  </span>
	<div class="spatial_details">
		More information
	</div>
</article>

</section>
    
    <script>
      /** Init **/ 
        initDatePicker();
        initDateDropDown();
      
      /** Date Picker **/
      
      function initDatePicker() {
        $('#datepicker').each(function() {
        	this.datepicker({
          showOn: 'button',
          buttonImage: 'calendar.png',
          buttonImageOnly: true,
          beforeShow: function(input, inst) {            
            setTimeout(function() {
              var $calendar = inst.dpDiv;            
              $calendar.position({
                my: 'left top',              
                at: 'left bottom+5',
                of: $('#date-dropdown')
              });
            }, 1);
          },
          onSelect: function() {
            syncDateDropdownWithDatePicker();
          }
        });
        });        
      }
      
      
      /** Date Dropdown **/
      
      function initDateDropDown() {
        var currentDate = new Date();
        var currentYear = currentDate.getFullYear();
        var currentMonth = currentDate.getMonth();
        var currentDay = currentDate.getDate();
        var numberOfDays = daysInMonth(currentYear, currentMonth);
        
        populateYearDropdown(1900, currentYear+10);
        populateMonthDropdown();
        populateDayDropdown(numberOfDays);
               
        selectYearDropdown(currentYear);
        selectMonthDropdown(currentMonth);
        selectDayDropdown(currentDay);
        
        bindYearDropdownEvent();
        bindMonthDropdownEvent();
        bindDayDropdownEvent();
      }      
      
      function populateYearDropdown(startYear, endYear) {
        var yearOptions = [];
        
        for (var y = startYear; y <= endYear; y++) {          
          yearOptions.push('<option value="' + y + '">' + y + '</option>');
        }
        
        $('#year').html(yearOptions.join());
      }
      
      function populateMonthDropdown() {
        var monthOptions = [];
        var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        for (var m = 0; m < months.length; m++) {          
          monthOptions.push('<option value="' + m + '">' + months[m] + '</option>');
        }
        
        $('#month').html(monthOptions.join());
      }
      
      function populateDayDropdown(numberOfDays) {
        var dayOptions = [];        
        for (var d = 1; d <= numberOfDays; d++) {          
          dayOptions.push('<option value="' + d + '">' + d + '</option>');
        }
        $('#day').html(dayOptions.join());
      }
      
      function selectYearDropdown(year) {
        $('#year option[value=' + year + ']').attr('selected', true);
      }
      
      function selectMonthDropdown(month) {
        $('#month option[value=' + month + ']').attr('selected', true);
      }
      
      function selectDayDropdown(day) {
        $('#day option[value=' + day + ']').attr('selected', true);
      }
      
      function refreshDayDropdown() {
        var year = parseInt($('#year').val());
        var month = parseInt($('#month').val());
        var day = parseInt($('#day').val());        
        var numberOfDays = daysInMonth(year, month);
        
        populateDayDropdown(numberOfDays);
        
        if (day <= numberOfDays) {
          selectDayDropdown(day);
        } else {
          selectDayDropdown(numberOfDays);
        }        
      }
      
      /*** Event handlers ***/
      
      function bindYearDropdownEvent() {
        $('#year').on('change', function() {
          refreshDayDropdown();
          syncDatePickerWithDateDropdown();
        });
      }
      
      function bindMonthDropdownEvent() {
        $('#month').on('change', function() {
          refreshDayDropdown();
          syncDatePickerWithDateDropdown();
        });
      }
      
      function bindDayDropdownEvent() {
        $('#day').on('change', function() {
          syncDatePickerWithDateDropdown();
        });
      }
      
      
      /** Sync Functions **/
      
      function syncDateDropdownWithDatePicker() {
        var datePickerDate = $('#datepicker').datepicker('getDate');
        selectYearDropdown(datePickerDate.getFullYear());
        selectMonthDropdown(datePickerDate.getMonth());
        refreshDayDropdown();
        selectDayDropdown(datePickerDate.getDate());
      }
      
      function syncDatePickerWithDateDropdown() {
        var dropdownYear = parseInt($('#year').val());
        var dropdownMonth = parseInt($('#month').val());
        var dropdownDay = parseInt($('#day').val());
        var dropdownDate = new Date(dropdownYear, dropdownMonth, dropdownDay);
        $('#datepicker').datepicker('setDate', dropdownDate);
      }
      
      
      /** Utility Function **/
      // Reference: http://stackoverflow.com/a/315767 + fguillen's comment
      function daysInMonth(year, month) {
        return new Date(year, month+1, 0).getDate();
      }
      
    </script>
