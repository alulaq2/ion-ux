<div class="navLeftMinimizeArrow"></div>
<div id="saveButtons">
 <button id="saveSearch" class="textRight">Save this Search</button><button id="searchBtn" class="textRight">Search</button>
</div>
<div id="customSearchName"><input class="customName" type="text" placeholder="name" /><button id="saveName" class="textRight">Save</button></div>
<div id="accordionContainer">
<article class="leftAccordion accordion_fixed" id="keyword">
  <div class="accordionLabel">Keyword</div>
  <input class="keyword" type="text" placeholder="Keyword" style="display:inline-block;"/>
</article>
<article class="leftAccordion" id="spatial">
</article>
<article class="leftAccordion" id="temporal">
  <span class="accordionTitle">
	 <div class="expandHide arrowRight"></div><div class="accordionLabel">Temporal</div>
  </span>
	<div class="spatialDetails" style="display:none;">
    <div class="leftNaviSelectContainer">
      <select class="temporal_menu">
        <option value="1">Data Collection</option>
        <option value="2">Planned Timestamps</option>
         <option value="3">Deployed Timestamps</option>
         <option value="4">Activated Timestamps</option>
      </select>
      <div class="leftNaviSelectArrow"/>
    </div>
		<div>From</div>
		<div class='date-dropdown from_date_menu'>
			<select class="dateMenu year"></select>
			<select class="dateMenu month"></select>
   		<select class="dateMenu day"></select>
      <select class="dateMenu hour"></select>
    </div>
		<div>To</div>
		<div class='date-dropdown to_date_menu'>
			<select class="dateMenu year"></select>
			<select class="dateMenu month"></select>
   		<select class="dateMenu day"></select>
      <select class="dateMenu hour"></select>
    </div>
	</div>
</article>
    <article class="leftAccordion" id="orgSelector">
      <span class="accordionTitle">
        <div class="expandHide arrowRight"></div><div class="accordionLabel">Facility</div>
      </span>
  <div class="spatialDetails" style="display:none;">
      </div>
    </article>
    
<article class="leftAccordion" id="region">
</article>
<article class="leftAccordion" id="site">
</article>
<article class="leftAccordion" id="platform">
  <span class="accordionTitle">
    <div class="expandHide arrowRight"></div><div class="accordionLabel">Platform</div>
  </span>
  <div class="spatialDetails" style="display:none;">
    More information
  </div>
</article>
<article class="leftAccordion" id="instrument">
  <span class="accordionTitle">
    <div class="expandHide arrowRight"></div><div class="accordionLabel">Instrument</div>
  </span>
  <div class="spatialDetails" style="display:none;">
    <ul class="instrument_list">
    </ul>
  </div>
</article>

    <article class="leftAccordion" id="dataTypesList">
      <span class="accordionTitle">
        <div class="expandHide arrowRight"></div><div class="accordionLabel">Data Type</div>
      </span>
    </article>
    
<article class="leftAccordion" id="boolean_expression">
  <span class="accordionTitle">
	 <div class="expandHide arrowRight"></div><div class="accordionLabel">Boolean Expression</div>
  </span>
	<div class="spatialDetails" style="display:none;">
		More information
	</div>
</article>

</div>

<script type="text/template" id="block_data_type_list_tmpl">{% include 'block_data_type_list2.html' %}</script>
    
    <script>
		IONUX2.Views.DataTypesList = Backbone.View.extend({
			el: '#dataTypesList',
			template: _.template($('#block_data_type_list_tmpl').html()),
      events: {
        'click .checkAllTypes': 'select_all_types'
      },
			initialize: function() {
				this.model.on('change:data', this.render, this);
			},
      select_all_types: function(e) {
        var $check = $(e.currentTarget);
        if ($check.is(':checked')) {
          $('.listDataTypes').find('input').prop('checked', true);
        }
        else {
          $('.listDataTypes').find('input').prop('checked', false);
        }
      },
			render: function() {
				this.$el.html(this.template({resources: this.model.data}));
				return this;
			}
		});	
		
      $(function(){

        IONUX2.Views.RegionList = new IONUX2.Views.Region({collection: IONUX2.Dashboard.Observatories });
        IONUX2.Views.SitesList = new IONUX2.Views.Sites({collection: IONUX2.Dashboard.Observatories });
		IONUX2.Models.DataTypeListInstance = new IONUX2.Models.DataTypeList();
		IONUX2.Views.DataTypesListInstance = new IONUX2.Views.DataTypesList({model: IONUX2.Models.DataTypeListInstance });
		IONUX2.Models.DataTypeListInstance.fetch();
		IONUX2.Collections.OrgsInstance = new IONUX2.Collections.Orgs();
		IONUX2.Views.OrgSelectorInstance = new IONUX2.Views.OrgSelector({collection: IONUX2.Collections.OrgsInstance});
		IONUX2.Collections.OrgsInstance.fetch();

        $('.spatialDetails').hide();
        $('#accordionContainer').sortable({
          items: "article:not(.accordion_fixed)"
        });
        $('#accordionContainer').jScrollPane({autoReinitialise: true});
        /** Init **/
        initDatePicker();
        initDateDropDown();
      
      });

      /** Date Picker **/
      
      function initDatePicker() {
        	$('#datepicker').datepicker({
          showOn: 'button',
          buttonImage: 'calendar.png',
          buttonImageOnly: true,
          beforeShow: function(input, inst) {            
            setTimeout(function() {
              var $calendar = inst.dpDiv;            
              $calendar.position({
                my: 'left top',              
                at: 'left bottom+5',
                of: $('#date-dropdown')
              });
            }, 1);
          },
          onSelect: function() {
            syncDateDropdownWithDatePicker();
          }
        });        
      }
      
      
      /** Date Dropdown **/
      
      function initDateDropDown() {
        var currentDate = new Date();
        var currentYear = currentDate.getFullYear();
        var currentMonth = currentDate.getMonth();
        var currentDay = currentDate.getDate();
        var numberOfDays = daysInMonth(currentYear, currentMonth);
        var numberofHours = 24;
        var currentHour = currentDate.getHours();
        
        populateYearDropdown(1900, currentYear+10);
        populateMonthDropdown();
        populateDayDropdown(numberOfDays);
        populateHourDropdown(numberofHours);
               
        selectYearDropdown(currentYear);
        selectMonthDropdown(currentMonth);
        selectDayDropdown(currentDay);
        selectHourDropdown(currentHour);
        
        bindYearDropdownEvent();
        bindMonthDropdownEvent();
        bindDayDropdownEvent();
        bindHourDropdownEvent();
      }      
      
      function populateYearDropdown(startYear, endYear) {
        var yearOptions = [];
        
        for (var y = startYear; y <= endYear; y++) {          
          yearOptions.push('<option value="' + y + '">' + y + '</option>');
        }
        
        $('.year').html(yearOptions.join());
      }
      
      function populateMonthDropdown() {
        var monthOptions = [];
        var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        for (var m = 0; m < months.length; m++) {          
          monthOptions.push('<option value="' + m + '">' + months[m] + '</option>');
        }
        
        $('.month').html(monthOptions.join());
      }
      
      function populateDayDropdown(numberOfDays) {
        var dayOptions = [];        
        for (var d = 1; d <= numberOfDays; d++) {          
          dayOptions.push('<option value="' + d + '">' + d + '</option>');
        }
        $('.day').html(dayOptions.join());
      }

      function populateHourDropdown(numberOfHours) {
        var hourOptions = [];
        for (var h=1; h<=numberOfHours; h++) {
          hourOptions.push('<option value="' + h + '">' + h + ':00</option>');
        }
        $('.hour').html(hourOptions.join());
      }
      
      function selectYearDropdown(year) {
        $('.year option[value=' + year + ']').attr('selected', true);
      }
      
      function selectMonthDropdown(month) {
        $('.month option[value=' + month + ']').attr('selected', true);
      }
      
      function selectDayDropdown(day) {
        $('.day option[value=' + day + ']').attr('selected', true);
      }

      function selectHourDropdown(hour) {
        $('.hour option[value=' + hour + ']').attr('selected', true);
      }
      
      function refreshDayDropdown() {
        var year = parseInt($('.year').val());
        var month = parseInt($('.month').val());
        var day = parseInt($('.day').val());   
        var numberOfDays = daysInMonth(year, month);
        
        populateDayDropdown(numberOfDays);
        
        if (day <= numberOfDays) {
          selectDayDropdown(day);
        } else {
          selectDayDropdown(numberOfDays);
        }        
      }
      
      /*** Event handlers ***/
      
      function bindYearDropdownEvent() {
        $('#year').on('change', function() {
          refreshDayDropdown();
          syncDatePickerWithDateDropdown();
        });
      }
      
      function bindMonthDropdownEvent() {
        $('#month').on('change', function() {
          refreshDayDropdown();
          syncDatePickerWithDateDropdown();
        });
      }
      
      function bindDayDropdownEvent() {
        $('#day').on('change', function() {
          syncDatePickerWithDateDropdown();
        });
      }

      function bindHourDropdownEvent() {
        $('#hour').on('change', function() {
          syncDatePickerWithDateDropdown();
        });
      }
      
      
      /** Sync Functions **/
      
      function syncDateDropdownWithDatePicker() {
        var datePickerDate = $('#datepicker').datepicker('getDate');
        selectYearDropdown(datePickerDate.getFullYear());
        selectMonthDropdown(datePickerDate.getMonth());
        refreshDayDropdown();
        selectDayDropdown(datePickerDate.getDate());
        selectHourDropdown(dataPickerDate.getHours());
      }
      
      function syncDatePickerWithDateDropdown() {
        var dropdownYear = parseInt($('.year').val());
        var dropdownMonth = parseInt($('.month').val());
        var dropdownDay = parseInt($('.day').val());
        var dropdownHour = parseInt($('.hour').val());
        var dropdownDate = new Date(dropdownYear, dropdownMonth, dropdownDay, dropdownHour);
        $('#datepicker').datepicker('setDate', dropdownDate);
      }
      
      
      /** Utility Function **/
      // Reference: http://stackoverflow.com/a/315767 + fguillen's comment
      function daysInMonth(year, month) {
        return new Date(year, month+1, 0).getDate();
      }
      
    </script>
