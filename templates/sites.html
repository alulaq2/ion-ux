<div class="select_all">
    <input class="checkAllSites" type="checkbox"/> Select All
</div>
<div class="list_sites">
    <form action="">

        <% _.each(resources, function(nested_resources, san) { %>

            <div id="regionName">
                <div class="expandHide arrowDown"></div> <%= san %><br/>
                <ul class="showSites">
                <% _.each(nested_resources, function(r) { %>
                    <li><input type="checkbox">
                        <% if (r.local_name) { %>
                            <%= r.local_name %><br/>
                        <% } else { %>
                            <%= r.name %><br/>
                        <% }; %>
                    </li>
                <% }) %>
                </ul>
            </div>
        <% }) %>

       
    </form>
</div>

<script>
    $(function(){
        $(".list_sites .resourceLink").click(function(){
            var resource_id = $(this).attr('data-id');
            var url = "/Observatory/face/"+resource_id+"/";
            IONUX.ROUTER.navigate('');
            IONUX.ROUTER.navigate(url, {trigger:true});
            $('#mapButtonHidden').click();
        });

        $('#regionName .expandHide').on('click', function(e) {
            e.preventDefault();
            var $link = $(e.currentTarget);
            $link.parent().children('.showSites').slideToggle('fast', function() {
                console.log($(this) + " and " + $link);
                if ($(this).is(':visible')) {
                    $link.removeClass('arrowRight').addClass('arrowDown');              
                } else {
                    $link.removeClass('arrowDown').addClass('arrowRight');
                }        
            });
        });
    });
</script>